@page
@model SvnHub.Web.Pages.Admin.UsersModel
@{
    ViewData["Title"] = "Users";
}

<div class="d-flex justify-content-between align-items-center gap-3 flex-wrap">
    <h1 class="mb-0">Users</h1>
    <div class="d-flex align-items-center gap-2 flex-wrap">
        <form method="get" class="d-flex align-items-center gap-2">
            <label class="text-muted small" for="pageSize">Per page</label>
            <select id="pageSize" name="pageSize" class="form-select form-select-sm" style="width: auto"
                    onchange="this.form.p.value = 1; this.form.submit();">
                @if (Model.PageSize == 10) { <option value="10" selected>10</option> } else { <option value="10">10</option> }
                @if (Model.PageSize == 25) { <option value="25" selected>25</option> } else { <option value="25">25</option> }
                @if (Model.PageSize == 50) { <option value="50" selected>50</option> } else { <option value="50">50</option> }
                @if (Model.PageSize == 100) { <option value="100" selected>100</option> } else { <option value="100">100</option> }
            </select>
            <input type="hidden" name="p" value="@Model.PageNumber" />
        </form>

        <a class="btn btn-primary" asp-page="/Admin/UsersCreate">Create</a>
    </div>
</div>

@if (!string.IsNullOrWhiteSpace(Model.Error))
{
    <div class="alert alert-danger mt-3">@Model.Error</div>
}

@if (!string.IsNullOrWhiteSpace(Model.Success))
{
    <div class="alert alert-success mt-3">@Model.Success</div>
}

@if (Model.TotalCount > 0)
{
    <div class="text-muted small mt-3">
        Showing @Model.FromIndex-@Model.ToIndex of @Model.TotalCount
    </div>
}

<div class="list-group list-group-flush sp-list mt-3">
    @foreach (var u in Model.Users)
    {
        <div class="list-group-item">
            <div class="d-flex align-items-start gap-3">
                <svg class="sp-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                    <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3z"/>
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                </svg>
                <div class="flex-grow-1">
                    <a asp-page="/Admin/User"
                       asp-route-userId="@u.Id"
                       class="repo-name link-primary link-offset-2 link-underline-opacity-0 link-underline-opacity-100-hover">
                        @u.UserName
                    </a>
                    <div class="text-muted small">
                        @UsersModel.ToRolesLabel(u.Roles)
                        @if (!u.IsActive)
                        {
                            <span class="ms-2 badge text-bg-secondary">Inactive</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@if (Model.TotalPages > 1)
{
    <nav aria-label="Users pagination">
        <ul class="pagination justify-content-center mt-4">
            <li class="page-item @(Model.PageNumber <= 1 ? "disabled" : "")">
                <a class="page-link"
                   asp-page="/Admin/Users"
                   asp-route-p="@(Model.PageNumber - 1)"
                   asp-route-pageSize="@Model.PageSize">Previous</a>
            </li>
            <li class="page-item disabled">
                <span class="page-link">Page @Model.PageNumber of @Model.TotalPages</span>
            </li>
            <li class="page-item @(Model.PageNumber >= Model.TotalPages ? "disabled" : "")">
                <a class="page-link"
                   asp-page="/Admin/Users"
                   asp-route-p="@(Model.PageNumber + 1)"
                   asp-route-pageSize="@Model.PageSize">Next</a>
            </li>
        </ul>
    </nav>
}
