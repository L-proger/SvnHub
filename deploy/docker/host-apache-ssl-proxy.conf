# Example Apache2 config (Ubuntu) for HTTPS on the host, proxying to SvnHub container (HTTP).
#
# Assumptions:
# - SvnHub container listens on http://127.0.0.1:8080 (see deploy/docker/docker-compose.yml)
# - All SVN + portal traffic is handled inside the container, host Apache only terminates TLS.
#
# Enable modules:
#   a2enmod proxy proxy_http headers ssl

# New URL (no port) + legacy URL (port 18080) proxied to the same container.
# For the legacy port, SVN clients should keep working without changing svn:externals.

<VirtualHost *:443>
    ServerName svn.example.com

    SSLEngine on
    # SSLCertificateFile /etc/letsencrypt/live/svn.example.com/fullchain.pem
    # SSLCertificateKeyFile /etc/letsencrypt/live/svn.example.com/privkey.pem

    ProxyPreserveHost On
    RequestHeader set X-Forwarded-Proto "https"

    # Subversion uses encoded paths; don't decode %2F, etc.
    AllowEncodedSlashes NoDecode

    ProxyPass        / http://127.0.0.1:8080/
    ProxyPassReverse / http://127.0.0.1:8080/
</VirtualHost>

<VirtualHost *:18080>
    ServerName svn.example.com

    SSLEngine on
    # SSLCertificateFile /etc/letsencrypt/live/svn.example.com/fullchain.pem
    # SSLCertificateKeyFile /etc/letsencrypt/live/svn.example.com/privkey.pem

    ProxyPreserveHost On
    RequestHeader set X-Forwarded-Proto "https"

    AllowEncodedSlashes NoDecode

    # Legacy URL: https://svn.example.com:18080/svn/
    ProxyPass        /svn http://127.0.0.1:8080/svn
    ProxyPassReverse /svn http://127.0.0.1:8080/svn
</VirtualHost>
